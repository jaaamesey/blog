<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><script>(() => {
    let o;
    const s = /* @__PURE__ */ new Set();
    function n() {
      const a = window.localStorage.getItem("colorSchemeOverride") || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      o = a;
      for (const i of s) i();
      a == "dark" ? document.documentElement.classList.add("colorSchemeDark") : document.documentElement.classList.remove("colorSchemeDark");
    }
    n(), window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", n), window._hooks = { setColorSchemeOverride(a) {
      window.localStorage.setItem("colorSchemeOverride", a || ""), n();
    }, onColorSchemeChanged(a) {
      return s.add(a), () => s.delete(a);
    }, getColorScheme() {
      const a = window.localStorage.getItem("colorSchemeOverride") || void 0;
      return { active: o, fromOverride: !!a, override: a, browserPreference: window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light" };
    } };
  })()</script><style>
            @font-face {
              font-family: "Playfair";
              src: url("/fonts/playfair.woff2");
            }
            @font-face {
              font-family: "Playfair Display";
              src: url("/fonts/playfairdisplay.woff2");
            }
            body {
              font-family: 'Playfair', serif;
            }
            h1 {
              font-family: 'Playfair Display', serif;
            }
          </style><script>window._$HY||(e=>{let t=e=>e&&e.hasAttribute&&(e.hasAttribute("data-hk")?e:t(e.host&&e.host.nodeType?e.host:e.parentNode));["click", "input"].forEach((o=>document.addEventListener(o,(o=>{if(!e.events)return;let s=t(o.composedPath&&o.composedPath()[0]||o.target);s&&!e.completed.has(s)&&e.events.push([s,o])}))))})(_$HY={events:[],completed:new WeakSet,r:{},fe(){}});</script><script>self.$R=self.$R||[];_$HY.r["000000001100000"]=$R[0]=($R[2]=r=>(r.p=new Promise((s,f)=>{r.s=s,r.f=f})))($R[1]={p:0,s:0,f:0});($R[3]=(r,d)=>{r.s(d),r.p.s=1,r.p.v=d})($R[1],!0);</script><!--xs--><link href="/_build/assets/client-B_JNecB5.css" rel="stylesheet" fetchPriority="high" /><link href="/_build/assets/web-DYO1r_n-.js" rel="modulepreload" /><link href="/_build/assets/preload-helper-ug3pwPZ1.js" rel="modulepreload" /><link href="/_build/assets/index-CxeZ2ADl.js" rel="modulepreload" /><link href="/_build/assets/routing-CouTEQdE.js" rel="modulepreload" /><link href="/_build/assets/client-naLqGCVE.js" rel="modulepreload" /><link href="/_build/assets/all_posts.compile-uYno7xFZ.js" rel="modulepreload" /><link href="/_build/assets/components-Dezfg5Cr.js" rel="modulepreload" /><link href="/_build/assets/jsx-runtime-CwYC41Ck.js" rel="modulepreload" /><link href="/_build/assets/embed_react_component-CqJ3mHPT.js" rel="modulepreload" /><link href="/_build/assets/index-BDpVB2cY.js" rel="modulepreload" /><meta data-sm="0000000000" name="description" content="James Karlsson's blog"/><title data-sm="00000000110000000002010">useState should require a dependency array</title></head><body><div id="app"><!--!$e000000--><link data-hk=00000000110000000000 href="/_build/assets/index-B0zURUJ_.css" rel="stylesheet" fetchPriority="high" /><link data-hk=00000000110000000001 href="/_build/assets/jsx-runtime-CCakz991.css" rel="stylesheet" fetchPriority="high" /><div data-hk=0000000011000000000200 class="min-h-screen flex justify-center py-8 px-4 text-text-primary overflow-x-clip"><!--$--><!--/--><div class="max-w-xl w-full"><header class="sticky top-5 not-sm:text-xs flex justify-between items-center pb-4 border-b border-border-color mb-8 z-1"><div style="position:absolute;background-color:rgb(var(--background-rgb));transition:var(--bg-transition);height:100%;width:100%;transform:scaleY(10) scaleX(5);transform-origin:center bottom;top:0;z-index:-1;opacity:0.975"></div><div class="text-text-secondary"><a data-hk=00000000110000000002020 style="view-transition-name:logo" href="/" class=" active" link="true" >james karlsson</a></div><div class="flex gap-2 text-text-secondary"></div><div class="text-text-secondary">2025-05-30</div></header><h1 class="text-4xl md:text-5xl mb-8 text-text-primary"><div><span style="view-transition-name:title-use_state_should_require_a_dependency_array">useState should require a dependency array</span></div></h1><div class="text-lg flex flex-col gap-4 mb-20 _postBody_1hrkg_1"><p data-hk=000000001100000000020420 >React has a wonderful hook called <a data-hk=000000001100000000020410 href="https://react.dev/reference/react/useState" ><code data-hk=000000001100000000020400 >useState</code></a> that we use to set and listen to things that might change over time.</p>
<p data-hk=000000001100000000020430 >There's a few points I'd like to argue here.</p>
<p data-hk=000000001100000000020460 >1. <strong data-hk=000000001100000000020450 >Using <code data-hk=000000001100000000020440 >useState</code> like this is bad, and should throw a lint error</strong>:</p>
<figure data-hk=0000000011000000000204a330 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204a320 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="ts" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204a310 data-language="ts" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204a120 data-line="" ><span data-hk=000000001100000000020470 style="color:#C678DD" >function</span><span data-hk=000000001100000000020480 style="color:#61AFEF" > Component</span><span data-hk=000000001100000000020490 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204a100 style="color:#E06C75;fontStyle:italic" >someProp</span><span data-hk=0000000011000000000204a110 style="color:#ABB2BF" > }) {</span></span>
<span data-hk=0000000011000000000204a140 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204a130 style="color:#7F848E;fontStyle:italic" >	// ESLint error: initial state depends on a mutable value</span></span>
<span data-hk=0000000011000000000204a260 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204a150 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204a160 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204a170 style="color:#E5C07B" >state</span><span data-hk=0000000011000000000204a180 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204a190 style="color:#E5C07B" >setState</span><span data-hk=0000000011000000000204a200 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204a210 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204a220 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204a230 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204a240 style="color:#E06C75" >someProp</span><span data-hk=0000000011000000000204a250 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204a280 data-line="" ><span data-hk=0000000011000000000204a270 style="color:#ABB2BF" >	...</span></span>
<span data-hk=0000000011000000000204a300 data-line="" ><span data-hk=0000000011000000000204a290 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204a370 >2. <strong data-hk=0000000011000000000204a350 >Derived state is <em data-hk=0000000011000000000204a340 >sometimes</em> a valid approach to solving a problem</strong>, but <strong data-hk=0000000011000000000204a360 >the escape hatches React suggests can be somewhat invasive and error-prone</strong>.</p>
<p data-hk=0000000011000000000204a400 >3. <strong data-hk=0000000011000000000204a390 >The "right" primitive for this would be a <code data-hk=0000000011000000000204a380 >useState</code> hook that requires a dependency array</strong>. The title. We'll get to that eventually.</p>
<p data-hk=0000000011000000000204a410 >Let's get started.</p>
<h2 data-hk=0000000011000000000204a420 >1. useState as it exists now should not allow derived state</h2>
<p data-hk=0000000011000000000204a430 >So, about that lint error I suggested. Maybe you've already identified the issue with the code above. If not, hopefully this demo illustrates it better:</p>
<div data-hk=0000000011000000000204a44 class="w-full bg-white text-black p-4 rounded-lg _demoWrapper_ksh75_1"><noscript>Looks like you have JavaScript disabled. You'll probably want to enable it for this demo to work properly.</noscript><!--$--><!--/--></div>
<p data-hk=0000000011000000000204a460 >When you change the "task" being edited, <strong data-hk=0000000011000000000204a450 >the text in the input doesn't change to whatever the title for the new task is for.</strong></p>
<p data-hk=0000000011000000000204a470 >But the text for the previous task you were editing before isn't relevant to the task you're editing now, right? Wouldn't you expect it to "reset" with the rest of the UI?</p>
<p data-hk=0000000011000000000204a480 >Let's see if anything familiar comes up in the code for that edit panel:</p>
<figure data-hk=0000000011000000000204b1310 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b1300 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="jsx" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b1290 data-language="jsx" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204a560 data-line="" ><span data-hk=0000000011000000000204a490 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204a500 style="color:#61AFEF" > EditPanel</span><span data-hk=0000000011000000000204a510 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204a520 style="color:#E06C75;fontStyle:italic" >item</span><span data-hk=0000000011000000000204a530 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204a540 style="color:#E06C75;fontStyle:italic" >saveName</span><span data-hk=0000000011000000000204a550 style="color:#ABB2BF" > }) {</span></span>
<span data-hk=0000000011000000000204a580 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204a570 style="color:#7F848E;fontStyle:italic" >	// This isn't reset when `item.name` changes!</span></span>
<span data-hk=0000000011000000000204a720 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204a590 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204a600 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204a610 style="color:#E5C07B" >name</span><span data-hk=0000000011000000000204a620 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204a630 style="color:#E5C07B" >setName</span><span data-hk=0000000011000000000204a640 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204a650 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204a660 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204a670 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204a680 style="color:#E5C07B" >item</span><span data-hk=0000000011000000000204a690 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204a700 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204a710 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204a750 data-line="" ><span data-hk=0000000011000000000204a730 style="color:#C678DD" >	return</span><span data-hk=0000000011000000000204a740 style="color:#ABB2BF" > (</span></span>
<span data-hk=0000000011000000000204a790 data-line="" ><span data-hk=0000000011000000000204a760 style="color:#ABB2BF" >		&lt;</span><span data-hk=0000000011000000000204a770 style="color:#E06C75" >div</span><span data-hk=0000000011000000000204a780 style="color:#ABB2BF" >></span></span>
<span data-hk=0000000011000000000204b1040 data-line="" ><span data-hk=0000000011000000000204a800 style="color:#ABB2BF" >			&lt;</span><span data-hk=0000000011000000000204a810 style="color:#E06C75" >input</span><span data-hk=0000000011000000000204a820 style="color:#D19A66;fontStyle:italic" > value</span><span data-hk=0000000011000000000204a830 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204a840 style="color:#C678DD" >{</span><span data-hk=0000000011000000000204a850 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204a860 style="color:#C678DD" >}</span><span data-hk=0000000011000000000204a870 style="color:#D19A66;fontStyle:italic" > onChange</span><span data-hk=0000000011000000000204a880 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204a890 style="color:#C678DD" >{</span><span data-hk=0000000011000000000204a900 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204a910 style="color:#E06C75;fontStyle:italic" >e</span><span data-hk=0000000011000000000204a920 style="color:#ABB2BF" >) </span><span data-hk=0000000011000000000204a930 style="color:#C678DD" >=></span><span data-hk=0000000011000000000204a940 style="color:#61AFEF" > setName</span><span data-hk=0000000011000000000204a950 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204a960 style="color:#E5C07B" >e</span><span data-hk=0000000011000000000204a970 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204a980 style="color:#E5C07B" >target</span><span data-hk=0000000011000000000204a990 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b1000 style="color:#E06C75" >value</span><span data-hk=0000000011000000000204b1010 style="color:#ABB2BF" >)</span><span data-hk=0000000011000000000204b1020 style="color:#C678DD" >}</span><span data-hk=0000000011000000000204b1030 style="color:#ABB2BF" > /></span></span>
<span data-hk=0000000011000000000204b1200 data-line="" ><span data-hk=0000000011000000000204b1050 style="color:#ABB2BF" >			&lt;</span><span data-hk=0000000011000000000204b1060 style="color:#E06C75" >button</span><span data-hk=0000000011000000000204b1070 style="color:#D19A66;fontStyle:italic" > onClick</span><span data-hk=0000000011000000000204b1080 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b1090 style="color:#C678DD" >{</span><span data-hk=0000000011000000000204b1100 style="color:#ABB2BF" >() </span><span data-hk=0000000011000000000204b1110 style="color:#C678DD" >=></span><span data-hk=0000000011000000000204b1120 style="color:#61AFEF" > saveName</span><span data-hk=0000000011000000000204b1130 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b1140 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204b1150 style="color:#ABB2BF" >)</span><span data-hk=0000000011000000000204b1160 style="color:#C678DD" >}</span><span data-hk=0000000011000000000204b1170 style="color:#ABB2BF" >>Save&lt;/</span><span data-hk=0000000011000000000204b1180 style="color:#E06C75" >button</span><span data-hk=0000000011000000000204b1190 style="color:#ABB2BF" >></span></span>
<span data-hk=0000000011000000000204b1240 data-line="" ><span data-hk=0000000011000000000204b1210 style="color:#ABB2BF" >		&lt;/</span><span data-hk=0000000011000000000204b1220 style="color:#E06C75" >div</span><span data-hk=0000000011000000000204b1230 style="color:#ABB2BF" >></span></span>
<span data-hk=0000000011000000000204b1260 data-line="" ><span data-hk=0000000011000000000204b1250 style="color:#ABB2BF" >	);</span></span>
<span data-hk=0000000011000000000204b1280 data-line="" ><span data-hk=0000000011000000000204b1270 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b1340 ><strong data-hk=0000000011000000000204b1330 >What we've done here is create <em data-hk=0000000011000000000204b1320 >un</em>-reactive code by accident.</strong></p>
<p data-hk=0000000011000000000204b1360 >Ideally, components should be dealing with the reality that a prop can change over time. But instead, we're taking a snapshot of only the <em data-hk=0000000011000000000204b1350 >initial</em> value of a prop, and ignoring any changes.</p>
<p data-hk=0000000011000000000204b1400 >It's a <a data-hk=0000000011000000000204b1370 href="https://stackoverflow.com/questions/58288286/what-is-derived-state-in-react-and-why-is-it-important" >fairly common position</a> that deriving <em data-hk=0000000011000000000204b1380 >any</em> mutable state from other state should be avoided where possible. In other words, you shouldn't be able to put a prop or some other piece of state inside a <code data-hk=0000000011000000000204b1390 >useState</code> call. And I'd agree to an extent - so much so that I think that piece of code should warrant the death penalty, or at least a warning from ESLint. But there's no such warning, and I haven't been strapped to the electric chair just yet.</p>
<p data-hk=0000000011000000000204b1410 >I've seen this problem come up way too often in production, and it's in no way exclusive to React - it's the reality of any moving part that is tied to another moving part, but also needs to move on its own for a while. You'll find the same problem in SolidJS, except...</p>
<figure data-hk=0000000011000000000204b1700 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b1690 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="js" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b1680 data-language="js" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b1470 data-line="" ><span data-hk=0000000011000000000204b1420 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b1430 style="color:#61AFEF" > SolidComponent</span><span data-hk=0000000011000000000204b1440 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b1450 style="color:#E06C75;fontStyle:italic" >props</span><span data-hk=0000000011000000000204b1460 style="color:#ABB2BF" >) {</span></span>
<span data-hk=0000000011000000000204b1490 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b1480 style="color:#7F848E;fontStyle:italic" >	// ESLint error: The reactive variable 'props.someProp' should be used within JSX, a tracked scope (like</span></span>
<span data-hk=0000000011000000000204b1510 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b1500 style="color:#7F848E;fontStyle:italic" >	// createEffect), or inside an event handler function, or else changes will be ignored.</span></span>
<span data-hk=0000000011000000000204b1650 data-line="" ><span data-hk=0000000011000000000204b1520 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b1530 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b1540 style="color:#E5C07B" >state</span><span data-hk=0000000011000000000204b1550 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b1560 style="color:#E5C07B" >setState</span><span data-hk=0000000011000000000204b1570 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b1580 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b1590 style="color:#61AFEF" > createSignal</span><span data-hk=0000000011000000000204b1600 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b1610 style="color:#E5C07B" >props</span><span data-hk=0000000011000000000204b1620 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b1630 style="color:#E06C75" >someProp</span><span data-hk=0000000011000000000204b1640 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b1670 data-line="" ><span data-hk=0000000011000000000204b1660 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b1720 >...Solid's recommended ESLint config <em data-hk=0000000011000000000204b1710 >does</em> fire a warning for this!</p>
<p data-hk=0000000011000000000204b1730 >So, I don't really see a reason why React's ESLint config shouldn't prohibit this.</p>
<h2 data-hk=0000000011000000000204b1740 >2. The unpleasant workarounds for derived state</h2>
<p data-hk=0000000011000000000204b1770 >React offers a few solutions to this problem, both in the old <a data-hk=0000000011000000000204b1750 href="https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html" >"You Probably Don't Need Derived State"</a> article (pre-hooks!), and in the <a data-hk=0000000011000000000204b1760 href="https://react.dev/reference/react/useState#resetting-state-with-a-key" >way more recent article on useState</a>.</p>
<p data-hk=0000000011000000000204b1790 >First, if the derived state you're creating is read-only, i.e. is only written to when the source state changes - you don't need <code data-hk=0000000011000000000204b1780 >useState</code> at all. You can just compute it directly like so:</p>
<figure data-hk=0000000011000000000204b2120 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b2110 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="js" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b2100 data-language="js" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b1850 data-line="" ><span data-hk=0000000011000000000204b1800 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b1810 style="color:#61AFEF" > Component</span><span data-hk=0000000011000000000204b1820 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b1830 style="color:#E06C75;fontStyle:italic" >a</span><span data-hk=0000000011000000000204b1840 style="color:#ABB2BF" > }) {</span></span>
<span data-hk=0000000011000000000204b1970 data-line="" ><span data-hk=0000000011000000000204b1860 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b1870 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b1880 style="color:#E5C07B" >b</span><span data-hk=0000000011000000000204b1890 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b1900 style="color:#E5C07B" >setB</span><span data-hk=0000000011000000000204b1910 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b1920 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b1930 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b1940 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b1950 style="color:#D19A66" >0</span><span data-hk=0000000011000000000204b1960 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b2050 data-line="" ><span data-hk=0000000011000000000204b1980 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b1990 style="color:#E5C07B" > sum</span><span data-hk=0000000011000000000204b2000 style="color:#56B6C2" > =</span><span data-hk=0000000011000000000204b2010 style="color:#E06C75" > a</span><span data-hk=0000000011000000000204b2020 style="color:#56B6C2" > +</span><span data-hk=0000000011000000000204b2030 style="color:#E06C75" > b</span><span data-hk=0000000011000000000204b2040 style="color:#ABB2BF" >;</span></span>
<span data-hk=0000000011000000000204b2070 data-line="" ><span data-hk=0000000011000000000204b2060 style="color:#ABB2BF" >	...</span></span>
<span data-hk=0000000011000000000204b2090 data-line="" ><span data-hk=0000000011000000000204b2080 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b2150 >Or, if you really don't want to re-compute it each render, and aren't using the new <a data-hk=0000000011000000000204b2130 href="https://react.dev/learn/react-compiler" >React Compiler</a>, there's <code data-hk=0000000011000000000204b2140 >useMemo</code>:</p>
<figure data-hk=0000000011000000000204b2550 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b2540 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="js" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b2530 data-language="js" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b2210 data-line="" ><span data-hk=0000000011000000000204b2160 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b2170 style="color:#61AFEF" > Component</span><span data-hk=0000000011000000000204b2180 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b2190 style="color:#E06C75;fontStyle:italic" >a</span><span data-hk=0000000011000000000204b2200 style="color:#ABB2BF" > }) {</span></span>
<span data-hk=0000000011000000000204b2330 data-line="" ><span data-hk=0000000011000000000204b2220 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b2230 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b2240 style="color:#E5C07B" >b</span><span data-hk=0000000011000000000204b2250 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b2260 style="color:#E5C07B" >setB</span><span data-hk=0000000011000000000204b2270 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b2280 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b2290 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b2300 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b2310 style="color:#D19A66" >0</span><span data-hk=0000000011000000000204b2320 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b2480 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b2340 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b2350 style="color:#E5C07B" > sum</span><span data-hk=0000000011000000000204b2360 style="color:#56B6C2" > =</span><span data-hk=0000000011000000000204b2370 style="color:#61AFEF" > useMemo</span><span data-hk=0000000011000000000204b2380 style="color:#ABB2BF" >(() </span><span data-hk=0000000011000000000204b2390 style="color:#C678DD" >=></span><span data-hk=0000000011000000000204b2400 style="color:#E06C75" > a</span><span data-hk=0000000011000000000204b2410 style="color:#56B6C2" > +</span><span data-hk=0000000011000000000204b2420 style="color:#E06C75" > b</span><span data-hk=0000000011000000000204b2430 style="color:#ABB2BF" >, [</span><span data-hk=0000000011000000000204b2440 style="color:#E06C75" >a</span><span data-hk=0000000011000000000204b2450 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b2460 style="color:#E06C75" >b</span><span data-hk=0000000011000000000204b2470 style="color:#ABB2BF" >]);</span></span>
<span data-hk=0000000011000000000204b2500 data-line="" ><span data-hk=0000000011000000000204b2490 style="color:#ABB2BF" >	...</span></span>
<span data-hk=0000000011000000000204b2520 data-line="" ><span data-hk=0000000011000000000204b2510 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b2600 >It's the cases that can't be represented this way - cases that need <em data-hk=0000000011000000000204b2560 >mutable</em> derived state - that get really messy. This tends to come up a lot when dealing with user input and optimistic updates (if you can't use <a data-hk=0000000011000000000204b2580 href="https://react.dev/reference/react/useOptimistic" ><code data-hk=0000000011000000000204b2570 >useOptimistic</code></a> or <a data-hk=0000000011000000000204b2590 href="https://tanstack.com/query/latest" >Tanstack Query</a> for whatever reason).</p>
<p data-hk=0000000011000000000204b2620 >Let's go back to the todo list example from before. The textbook way of fixing this is through the <code data-hk=0000000011000000000204b2610 >key</code> prop, which exists on every React component. So, let's add that to where this component is used:</p>
<figure data-hk=0000000011000000000204b2820 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b2810 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="jsx" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b2800 data-language="jsx" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b2790 data-line="" ><span data-hk=0000000011000000000204b2630 style="color:#ABB2BF" >&lt;</span><span data-hk=0000000011000000000204b2640 style="color:#E5C07B" >EditPanel</span><span data-hk=0000000011000000000204b2650 style="color:#D19A66;fontStyle:italic" > item</span><span data-hk=0000000011000000000204b2660 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b2670 style="color:#C678DD" >{</span><span data-hk=0000000011000000000204b2680 style="color:#E06C75" >items</span><span data-hk=0000000011000000000204b2690 style="color:#ABB2BF" >[</span><span data-hk=0000000011000000000204b2700 style="color:#E06C75" >selectedItemId</span><span data-hk=0000000011000000000204b2710 style="color:#ABB2BF" >]</span><span data-hk=0000000011000000000204b2720 style="color:#C678DD" >}</span><span data-hk=0000000011000000000204b2730 style="color:#D19A66;fontStyle:italic" > key</span><span data-hk=0000000011000000000204b2740 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b2750 style="color:#C678DD" >{</span><span data-hk=0000000011000000000204b2760 style="color:#E06C75" >selectedItemId</span><span data-hk=0000000011000000000204b2770 style="color:#C678DD" >}</span><span data-hk=0000000011000000000204b2780 style="color:#ABB2BF" > /></span></span></code></pre></figure>
<div data-hk=0000000011000000000204b283 class="w-full bg-white text-black p-4 rounded-lg _demoWrapper_ksh75_1"><noscript>Looks like you have JavaScript disabled. You'll probably want to enable it for this demo to work properly.</noscript><!--$--><!--/--></div>
<p data-hk=0000000011000000000204b2840 >And it works - the input field changes when we edit a new task!</p>
<p data-hk=0000000011000000000204b2860 >But we have to be careful with this - what if there's still some state that we want to <em data-hk=0000000011000000000204b2850 >preserve</em>?</p>
<p data-hk=0000000011000000000204b2880 >Call it contrived, but maybe we want to add <em data-hk=0000000011000000000204b2870 >drawings</em> to our tasks. With different brush colours.</p>
<figure data-hk=0000000011000000000204b3110 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b3100 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="js" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b3090 data-language="js" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b2920 data-line="" ><span data-hk=0000000011000000000204b2890 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b2900 style="color:#61AFEF" > EditPanel</span><span data-hk=0000000011000000000204b2910 style="color:#ABB2BF" >(...) {</span></span>
<span data-hk=0000000011000000000204b3040 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b2930 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b2940 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b2950 style="color:#E5C07B" >brushColor</span><span data-hk=0000000011000000000204b2960 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b2970 style="color:#E5C07B" >setBrushColor</span><span data-hk=0000000011000000000204b2980 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b2990 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b3000 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b3010 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b3020 style="color:#98C379" >'black'</span><span data-hk=0000000011000000000204b3030 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b3060 data-line="" ><span data-hk=0000000011000000000204b3050 style="color:#ABB2BF" >	...</span></span>
<span data-hk=0000000011000000000204b3080 data-line="" ><span data-hk=0000000011000000000204b3070 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<div data-hk=0000000011000000000204b312 class="w-full bg-white text-black p-4 rounded-lg _demoWrapper_ksh75_1"><noscript>Looks like you have JavaScript disabled. You'll probably want to enable it for this demo to work properly.</noscript><!--$--><!--/--></div>
<p data-hk=0000000011000000000204b3140 ><strong data-hk=0000000011000000000204b3130 >Try changing the brush colour before selecting another task.</strong></p>
<p data-hk=0000000011000000000204b3150 >Why should the colour we're drawing with reset each time we change what task we're editing? That state might be part of the same component, but it shouldn't be joined to the specific task we're editing.</p>
<p data-hk=0000000011000000000204b3190 >If <code data-hk=0000000011000000000204b3160 >key</code> changes between renders, the entire component tree below that point is <em data-hk=0000000011000000000204b3170 >"remounted"</em>. That means that the underlying DOM nodes will be re-created, and that <em data-hk=0000000011000000000204b3180 >any</em> state declared below that point will be trashed and reset.</p>
<p data-hk=0000000011000000000204b3220 >This is why we're now seeing that field reset as expected, and why we're seeing the chosen brush colour reset as <em data-hk=0000000011000000000204b3200 >not</em> expected. We can't just reset state at the level of a single <code data-hk=0000000011000000000204b3210 >useState</code> hook, or even a single component instance.</p>
<p data-hk=0000000011000000000204b3250 >You might have also noticed that we're now passing on the responsibility of resetting this state to the <em data-hk=0000000011000000000204b3230 >consumer</em> of this component. What if we end up using it elsewhere, but forget to provide a <code data-hk=0000000011000000000204b3240 >key</code> prop? Also, what if you have more than one dependency that should cause a component to reset? You're going to need to merge those into a single key somehow.</p>
<p data-hk=0000000011000000000204b3270 >So, sometimes forcing a remount with <code data-hk=0000000011000000000204b3260 >key</code> is absolutely the right option, but there's cases where it's too much of an ask.</p>
<p data-hk=0000000011000000000204b3290 >For those cases, <a data-hk=0000000011000000000204b3280 href="https://react.dev/reference/react/useState#storing-information-from-previous-renders" >the React docs provides a pattern that's a bit more isolated</a>:</p>
<figure data-hk=0000000011000000000204b4240 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b4230 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="js" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b4220 data-language="js" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b3370 data-line="" ><span data-hk=0000000011000000000204b3300 style="color:#C678DD" >export</span><span data-hk=0000000011000000000204b3310 style="color:#C678DD" > default</span><span data-hk=0000000011000000000204b3320 style="color:#C678DD" > function</span><span data-hk=0000000011000000000204b3330 style="color:#61AFEF" > CountLabel</span><span data-hk=0000000011000000000204b3340 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b3350 style="color:#E06C75;fontStyle:italic" >count</span><span data-hk=0000000011000000000204b3360 style="color:#ABB2BF" > }) {</span></span>
<span data-hk=0000000011000000000204b3490 data-line="" ><span data-hk=0000000011000000000204b3380 style="color:#C678DD" >  const</span><span data-hk=0000000011000000000204b3390 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b3400 style="color:#E5C07B" >prevCount</span><span data-hk=0000000011000000000204b3410 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b3420 style="color:#E5C07B" >setPrevCount</span><span data-hk=0000000011000000000204b3430 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b3440 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b3450 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b3460 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b3470 style="color:#E06C75" >count</span><span data-hk=0000000011000000000204b3480 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b3610 data-line="" ><span data-hk=0000000011000000000204b3500 style="color:#C678DD" >  const</span><span data-hk=0000000011000000000204b3510 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b3520 style="color:#E5C07B" >trend</span><span data-hk=0000000011000000000204b3530 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b3540 style="color:#E5C07B" >setTrend</span><span data-hk=0000000011000000000204b3550 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b3560 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b3570 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b3580 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b3590 style="color:#D19A66" >null</span><span data-hk=0000000011000000000204b3600 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b3680 data-line="" ><span data-hk=0000000011000000000204b3620 style="color:#C678DD" >  if</span><span data-hk=0000000011000000000204b3630 style="color:#ABB2BF" > (</span><span data-hk=0000000011000000000204b3640 style="color:#E06C75" >prevCount</span><span data-hk=0000000011000000000204b3650 style="color:#56B6C2" > !==</span><span data-hk=0000000011000000000204b3660 style="color:#E06C75" > count</span><span data-hk=0000000011000000000204b3670 style="color:#ABB2BF" >) {</span></span>
<span data-hk=0000000011000000000204b3730 data-line="" ><span data-hk=0000000011000000000204b3690 style="color:#61AFEF" >    setPrevCount</span><span data-hk=0000000011000000000204b3700 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b3710 style="color:#E06C75" >count</span><span data-hk=0000000011000000000204b3720 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b3840 data-line="" ><span data-hk=0000000011000000000204b3740 style="color:#61AFEF" >    setTrend</span><span data-hk=0000000011000000000204b3750 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b3760 style="color:#E06C75" >count</span><span data-hk=0000000011000000000204b3770 style="color:#56B6C2" > ></span><span data-hk=0000000011000000000204b3780 style="color:#E06C75" > prevCount</span><span data-hk=0000000011000000000204b3790 style="color:#C678DD" > ?</span><span data-hk=0000000011000000000204b3800 style="color:#98C379" > 'increasing'</span><span data-hk=0000000011000000000204b3810 style="color:#C678DD" > :</span><span data-hk=0000000011000000000204b3820 style="color:#98C379" > 'decreasing'</span><span data-hk=0000000011000000000204b3830 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b3860 data-line="" ><span data-hk=0000000011000000000204b3850 style="color:#ABB2BF" >  }</span></span>
<span data-hk=0000000011000000000204b3890 data-line="" ><span data-hk=0000000011000000000204b3870 style="color:#C678DD" >  return</span><span data-hk=0000000011000000000204b3880 style="color:#ABB2BF" > (</span></span>
<span data-hk=0000000011000000000204b3910 data-line="" ><span data-hk=0000000011000000000204b3900 style="color:#ABB2BF" >    &lt;></span></span>
<span data-hk=0000000011000000000204b4010 data-line="" ><span data-hk=0000000011000000000204b3920 style="color:#ABB2BF" >      &lt;</span><span data-hk=0000000011000000000204b3930 style="color:#E06C75" >h1</span><span data-hk=0000000011000000000204b3940 style="color:#ABB2BF" >></span><span data-hk=0000000011000000000204b3950 style="color:#C678DD" >{</span><span data-hk=0000000011000000000204b3960 style="color:#E06C75" >count</span><span data-hk=0000000011000000000204b3970 style="color:#C678DD" >}</span><span data-hk=0000000011000000000204b3980 style="color:#ABB2BF" >&lt;/</span><span data-hk=0000000011000000000204b3990 style="color:#E06C75" >h1</span><span data-hk=0000000011000000000204b4000 style="color:#ABB2BF" >></span></span>
<span data-hk=0000000011000000000204b4150 data-line="" ><span data-hk=0000000011000000000204b4020 style="color:#C678DD" >      {</span><span data-hk=0000000011000000000204b4030 style="color:#E06C75" >trend</span><span data-hk=0000000011000000000204b4040 style="color:#56B6C2" > &amp;&amp;</span><span data-hk=0000000011000000000204b4050 style="color:#ABB2BF" > &lt;</span><span data-hk=0000000011000000000204b4060 style="color:#E06C75" >p</span><span data-hk=0000000011000000000204b4070 style="color:#ABB2BF" >>The count is </span><span data-hk=0000000011000000000204b4080 style="color:#C678DD" >{</span><span data-hk=0000000011000000000204b4090 style="color:#E06C75" >trend</span><span data-hk=0000000011000000000204b4100 style="color:#C678DD" >}</span><span data-hk=0000000011000000000204b4110 style="color:#ABB2BF" >&lt;/</span><span data-hk=0000000011000000000204b4120 style="color:#E06C75" >p</span><span data-hk=0000000011000000000204b4130 style="color:#ABB2BF" >></span><span data-hk=0000000011000000000204b4140 style="color:#C678DD" >}</span></span>
<span data-hk=0000000011000000000204b4170 data-line="" ><span data-hk=0000000011000000000204b4160 style="color:#ABB2BF" >    &lt;/></span></span>
<span data-hk=0000000011000000000204b4190 data-line="" ><span data-hk=0000000011000000000204b4180 style="color:#ABB2BF" >  );</span></span>
<span data-hk=0000000011000000000204b4210 data-line="" ><span data-hk=0000000011000000000204b4200 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b4270 >The nicest thing I can say about this is that it works - this <em data-hk=0000000011000000000204b4250 >would</em> force only the state we specify to reset. And at the very least, React <em data-hk=0000000011000000000204b4260 >does</em> prevent Effects from running and children from re-rendering if all a render here does is trigger another render.</p>
<p data-hk=0000000011000000000204b4290 >But despite this pattern only being applied to <em data-hk=0000000011000000000204b4280 >one</em> value, it already looks quite janky. We now have to manage previous state, and there's a lot of room for things to go wrong. Maybe our condition gets us stuck in an infinite loop, or maybe we accidentally omit a dependency that we should be listening to.</p>
<p data-hk=0000000011000000000204b4310 >Now, what I've seen more in practice is code that looks like this, which definitely <em data-hk=0000000011000000000204b4300 >seems</em> more elegant:</p>
<figure data-hk=0000000011000000000204b4740 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b4730 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="jsx" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b4720 data-language="jsx" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b4370 data-line="" ><span data-hk=0000000011000000000204b4320 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b4330 style="color:#61AFEF" > EditPanel</span><span data-hk=0000000011000000000204b4340 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b4350 style="color:#E06C75;fontStyle:italic" >item</span><span data-hk=0000000011000000000204b4360 style="color:#ABB2BF" >, ... }) {</span></span>
<span data-hk=0000000011000000000204b4510 data-line="" ><span data-hk=0000000011000000000204b4380 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b4390 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b4400 style="color:#E5C07B" >name</span><span data-hk=0000000011000000000204b4410 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b4420 style="color:#E5C07B" >setName</span><span data-hk=0000000011000000000204b4430 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b4440 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b4450 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b4460 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b4470 style="color:#E5C07B" >item</span><span data-hk=0000000011000000000204b4480 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b4490 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204b4500 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b4560 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b4520 style="color:#61AFEF" >	useEffect</span><span data-hk=0000000011000000000204b4530 style="color:#ABB2BF" >(() </span><span data-hk=0000000011000000000204b4540 style="color:#C678DD" >=></span><span data-hk=0000000011000000000204b4550 style="color:#ABB2BF" > {</span></span>
<span data-hk=0000000011000000000204b4630 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b4570 style="color:#61AFEF" >		setName</span><span data-hk=0000000011000000000204b4580 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b4590 style="color:#E5C07B" >item</span><span data-hk=0000000011000000000204b4600 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b4610 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204b4620 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b4690 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b4640 style="color:#ABB2BF" >	}, [</span><span data-hk=0000000011000000000204b4650 style="color:#E5C07B" >item</span><span data-hk=0000000011000000000204b4660 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b4670 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204b4680 style="color:#ABB2BF" >]);</span></span>
<span data-hk=0000000011000000000204b4710 data-line="" ><span data-hk=0000000011000000000204b4700 style="color:#ABB2BF" >...</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b4750 >But this introduces an unnecessary re-render. What's even worse is the fact that the first re-render has a mix of stale and non-stale data, leading to potentially dangerous behaviour with other useEffects:</p>
<figure data-hk=0000000011000000000204b5210 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b5200 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="jsx" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b5190 data-language="jsx" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b4810 data-line="" ><span data-hk=0000000011000000000204b4760 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b4770 style="color:#61AFEF" > EditPanel</span><span data-hk=0000000011000000000204b4780 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b4790 style="color:#E06C75;fontStyle:italic" >item</span><span data-hk=0000000011000000000204b4800 style="color:#ABB2BF" >, ... }) {</span></span>
<span data-hk=0000000011000000000204b4830 data-line="" ><span data-hk=0000000011000000000204b4820 style="color:#ABB2BF" >...</span></span>
<span data-hk=0000000011000000000204b4880 data-line="" ><span data-hk=0000000011000000000204b4840 style="color:#61AFEF" >	useEffect</span><span data-hk=0000000011000000000204b4850 style="color:#ABB2BF" >(() </span><span data-hk=0000000011000000000204b4860 style="color:#C678DD" >=></span><span data-hk=0000000011000000000204b4870 style="color:#ABB2BF" > {</span></span>
<span data-hk=0000000011000000000204b5010 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b4890 style="color:#E5C07B" >		someDatabase</span><span data-hk=0000000011000000000204b4900 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b4910 style="color:#61AFEF" >sync</span><span data-hk=0000000011000000000204b4920 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b4930 style="color:#E06C75" >id</span><span data-hk=0000000011000000000204b4940 style="color:#ABB2BF" >: </span><span data-hk=0000000011000000000204b4950 style="color:#E5C07B" >item</span><span data-hk=0000000011000000000204b4960 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b4970 style="color:#E06C75" >id</span><span data-hk=0000000011000000000204b4980 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b4990 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204b5000 style="color:#ABB2BF" > });</span></span>
<span data-hk=0000000011000000000204b5090 data-line="" ><span data-hk=0000000011000000000204b5020 style="color:#ABB2BF" >	}, [</span><span data-hk=0000000011000000000204b5030 style="color:#E5C07B" >item</span><span data-hk=0000000011000000000204b5040 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b5050 style="color:#E06C75" >id</span><span data-hk=0000000011000000000204b5060 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b5070 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204b5080 style="color:#ABB2BF" >]);</span></span>
<span data-hk=0000000011000000000204b5110 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b5100 style="color:#7F848E;fontStyle:italic" >	// Runs twice when item.id changes:</span></span>
<span data-hk=0000000011000000000204b5130 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b5120 style="color:#7F848E;fontStyle:italic" >	// 1. someDatabase.sync({ id: 'Second item ID', name: 'First item name' }) (incorrect!)</span></span>
<span data-hk=0000000011000000000204b5150 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b5140 style="color:#7F848E;fontStyle:italic" >	// 2. someDatabase.sync({ id: 'Second item ID', name: 'Second item name' })</span></span>
<span data-hk=0000000011000000000204b5170 data-line="" ><span data-hk=0000000011000000000204b5160 style="color:#ABB2BF" >...</span></span>
<span data-hk=0000000011000000000204b5180 data-line="" > </span></code></pre></figure>
<h2 data-hk=0000000011000000000204b5220 >3. Better primitives for mutable derived state</h2>
<p data-hk=0000000011000000000204b5250 >In my opinion, these workarounds are far more complex than just having proper tools for mutable derived state. And these days, at least <a data-hk=0000000011000000000204b5230 href="https://svelte.dev/docs/svelte/$derived" >Svelte</a> and <a data-hk=0000000011000000000204b5240 href="https://dev.to/this-is-learning/mutable-derivations-in-reactivity-2ffl" >SolidJS</a> seem to agree.</p>
<p data-hk=0000000011000000000204b5270 >Let's look at the <code data-hk=0000000011000000000204b5260 >createWritable</code> "hook" being proposed for Solid. Its implementation is actually fairly simple, and reveals a lot about its expected behaviour.</p>
<p data-hk=0000000011000000000204b5280 >Some context:</p>
<ul data-hk=0000000011000000000204b5370 >
<li data-hk=0000000011000000000204b5300 >Solid components only render once, so instead of "hooks" you just have factory functions that usually start with <code data-hk=0000000011000000000204b5290 >create</code>.</li>
<li data-hk=0000000011000000000204b5330 ><code data-hk=0000000011000000000204b5310 >createSignal</code> is basically just <code data-hk=0000000011000000000204b5320 >useState</code>.</li>
<li data-hk=0000000011000000000204b5360 ><code data-hk=0000000011000000000204b5340 >createMemo</code> is basically just <code data-hk=0000000011000000000204b5350 >useMemo</code>, but automatically derives its dependencies instead of requiring a dependency array.</li>
</ul>
<figure data-hk=0000000011000000000204b5890 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b5880 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="js" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b5870 data-language="js" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b5410 data-line="" ><span data-hk=0000000011000000000204b5380 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b5390 style="color:#61AFEF" > createWritable</span><span data-hk=0000000011000000000204b5400 style="color:#ABB2BF" >(</span></span>
<span data-hk=0000000011000000000204b5430 data-line="" ><span data-hk=0000000011000000000204b5420 style="color:#7F848E;fontStyle:italic" >	// Function for computing "initial" state</span></span>
<span data-hk=0000000011000000000204b5460 data-line="" ><span data-hk=0000000011000000000204b5440 style="color:#E06C75;fontStyle:italic" >	fn</span><span data-hk=0000000011000000000204b5450 style="color:#ABB2BF" >,</span></span>
<span data-hk=0000000011000000000204b5480 data-line="" ><span data-hk=0000000011000000000204b5470 style="color:#ABB2BF" >) {</span></span>
<span data-hk=0000000011000000000204b5500 data-line="" ><span data-hk=0000000011000000000204b5490 style="color:#7F848E;fontStyle:italic" >  // When dependencies used by `fn` change, the memoized state is </span></span>
<span data-hk=0000000011000000000204b5520 data-line="" ><span data-hk=0000000011000000000204b5510 style="color:#7F848E;fontStyle:italic" >  // discarded and recomputed</span></span>
<span data-hk=0000000011000000000204b5630 data-line="" ><span data-hk=0000000011000000000204b5530 style="color:#C678DD" >  const</span><span data-hk=0000000011000000000204b5540 style="color:#E5C07B" > computed</span><span data-hk=0000000011000000000204b5550 style="color:#56B6C2" > =</span><span data-hk=0000000011000000000204b5560 style="color:#61AFEF" > createMemo</span><span data-hk=0000000011000000000204b5570 style="color:#ABB2BF" >(() </span><span data-hk=0000000011000000000204b5580 style="color:#C678DD" >=></span><span data-hk=0000000011000000000204b5590 style="color:#61AFEF" > createSignal</span><span data-hk=0000000011000000000204b5600 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b5610 style="color:#61AFEF" >fn</span><span data-hk=0000000011000000000204b5620 style="color:#ABB2BF" >()))</span></span>
<span data-hk=0000000011000000000204b5650 data-line="" ><span data-hk=0000000011000000000204b5640 style="color:#7F848E;fontStyle:italic" >  // This looks scary, but it's basically just returning the getters</span></span>
<span data-hk=0000000011000000000204b5670 data-line="" ><span data-hk=0000000011000000000204b5660 style="color:#7F848E;fontStyle:italic" >  // and setters from the state declared above</span></span>
<span data-hk=0000000011000000000204b5840 data-line="" ><span data-hk=0000000011000000000204b5680 style="color:#C678DD" >  return</span><span data-hk=0000000011000000000204b5690 style="color:#ABB2BF" > [() </span><span data-hk=0000000011000000000204b5700 style="color:#C678DD" >=></span><span data-hk=0000000011000000000204b5710 style="color:#61AFEF" > computed</span><span data-hk=0000000011000000000204b5720 style="color:#ABB2BF" >()[</span><span data-hk=0000000011000000000204b5730 style="color:#D19A66" >0</span><span data-hk=0000000011000000000204b5740 style="color:#ABB2BF" >](), (</span><span data-hk=0000000011000000000204b5750 style="color:#E06C75;fontStyle:italic" >v</span><span data-hk=0000000011000000000204b5760 style="color:#ABB2BF" >) </span><span data-hk=0000000011000000000204b5770 style="color:#C678DD" >=></span><span data-hk=0000000011000000000204b5780 style="color:#61AFEF" > computed</span><span data-hk=0000000011000000000204b5790 style="color:#ABB2BF" >()[</span><span data-hk=0000000011000000000204b5800 style="color:#D19A66" >1</span><span data-hk=0000000011000000000204b5810 style="color:#ABB2BF" >](</span><span data-hk=0000000011000000000204b5820 style="color:#E06C75" >v</span><span data-hk=0000000011000000000204b5830 style="color:#ABB2BF" >))]</span></span>
<span data-hk=0000000011000000000204b5860 data-line="" ><span data-hk=0000000011000000000204b5850 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b5920 >What this returns is state that is <em data-hk=0000000011000000000204b5900 >memoized</em> by whatever dependencies were used to create that state. Just like Svelte's <code data-hk=0000000011000000000204b5910 >$derived</code>, that state can change over the lifetime of its dependencies - but once one of those dependencies changes, that state is trashed and re-computed.</p>
<p data-hk=0000000011000000000204b5960 >I'm only using Solid's implementation as an example here because implementing a hook like this in React is actually quite annoying. For starters, <a data-hk=0000000011000000000204b5930 href="https://react.dev/reference/rules/rules-of-hooks#only-call-hooks-at-the-top-level" >Rules of Hooks</a> prevents you from nesting a <code data-hk=0000000011000000000204b5940 >useState</code> inside a <code data-hk=0000000011000000000204b5950 >useMemo</code>.</p>
<p data-hk=0000000011000000000204b5980 >But React implementations of this concept do exist, such as <a data-hk=0000000011000000000204b5970 href="https://react.dev/reference/react/useState#storing-information-from-previous-renders" >use-state-with-deps</a>. Let's give it a shot.</p>
<figure data-hk=0000000011000000000204b6380 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b6370 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="jsx" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b6360 data-language="jsx" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b6080 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b5990 style="color:#C678DD" >import</span><span data-hk=0000000011000000000204b6000 style="color:#ABB2BF" > { </span><span data-hk=0000000011000000000204b6010 style="color:#E06C75" >useStateWithDeps</span><span data-hk=0000000011000000000204b6020 style="color:#C678DD" > as</span><span data-hk=0000000011000000000204b6030 style="color:#E06C75" > useState</span><span data-hk=0000000011000000000204b6040 style="color:#ABB2BF" > } </span><span data-hk=0000000011000000000204b6050 style="color:#C678DD" >from</span><span data-hk=0000000011000000000204b6060 style="color:#98C379" > 'use-state-with-deps'</span><span data-hk=0000000011000000000204b6070 style="color:#ABB2BF" >;</span></span>
<span data-hk=0000000011000000000204b6090 data-line="" > </span>
<span data-hk=0000000011000000000204b6150 data-line="" ><span data-hk=0000000011000000000204b6100 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b6110 style="color:#61AFEF" > EditPanel</span><span data-hk=0000000011000000000204b6120 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b6130 style="color:#E06C75;fontStyle:italic" >item</span><span data-hk=0000000011000000000204b6140 style="color:#ABB2BF" >, ... }) {</span></span>
<span data-hk=0000000011000000000204b6310 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b6160 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b6170 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b6180 style="color:#E5C07B" >name</span><span data-hk=0000000011000000000204b6190 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b6200 style="color:#E5C07B" >setName</span><span data-hk=0000000011000000000204b6210 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b6220 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b6230 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b6240 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b6250 style="color:#E5C07B" >item</span><span data-hk=0000000011000000000204b6260 style="color:#ABB2BF" >.</span><span data-hk=0000000011000000000204b6270 style="color:#E06C75" >name</span><span data-hk=0000000011000000000204b6280 style="color:#ABB2BF" >, [</span><span data-hk=0000000011000000000204b6290 style="color:#E06C75" >item</span><span data-hk=0000000011000000000204b6300 style="color:#ABB2BF" >]);</span></span>
<span data-hk=0000000011000000000204b6330 data-line="" ><span data-hk=0000000011000000000204b6320 style="color:#ABB2BF" >	...</span></span>
<span data-hk=0000000011000000000204b6350 data-line="" ><span data-hk=0000000011000000000204b6340 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<div data-hk=0000000011000000000204b639 class="w-full bg-white text-black p-4 rounded-lg _demoWrapper_ksh75_1"><noscript>Looks like you have JavaScript disabled. You'll probably want to enable it for this demo to work properly.</noscript><!--$--><!--/--></div>
<p data-hk=0000000011000000000204b6420 >No messing with <code data-hk=0000000011000000000204b6400 >key</code>, weird setter calls in the render method, or <code data-hk=0000000011000000000204b6410 >useEffect</code> - it just kinda works.</p>
<p data-hk=0000000011000000000204b6450 >What I'm proposing is that <strong data-hk=0000000011000000000204b6440 >this becomes how <code data-hk=0000000011000000000204b6430 >useState</code> works by default</strong>.</p>
<p data-hk=0000000011000000000204b6460 >Remember that ESLint error I proposed further up? Maybe it should look more like this:</p>
<figure data-hk=0000000011000000000204b6730 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b6720 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="ts" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b6710 data-language="ts" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b6520 data-line="" ><span data-hk=0000000011000000000204b6470 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b6480 style="color:#61AFEF" > Component</span><span data-hk=0000000011000000000204b6490 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b6500 style="color:#E06C75;fontStyle:italic" >someProp</span><span data-hk=0000000011000000000204b6510 style="color:#ABB2BF" > }) {</span></span>
<span data-hk=0000000011000000000204b6540 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b6530 style="color:#7F848E;fontStyle:italic" >	// ESLint error: someProp not specified in dependency array</span></span>
<span data-hk=0000000011000000000204b6660 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b6550 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b6560 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b6570 style="color:#E5C07B" >state</span><span data-hk=0000000011000000000204b6580 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b6590 style="color:#E5C07B" >setState</span><span data-hk=0000000011000000000204b6600 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b6610 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b6620 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b6630 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b6640 style="color:#E06C75" >someProp</span><span data-hk=0000000011000000000204b6650 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b6680 data-line="" ><span data-hk=0000000011000000000204b6670 style="color:#ABB2BF" >	...</span></span>
<span data-hk=0000000011000000000204b6700 data-line="" ><span data-hk=0000000011000000000204b6690 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b6740 >...and be fixed like so:</p>
<figure data-hk=0000000011000000000204b7030 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b7020 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="js" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b7010 data-language="js" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b6800 data-line="" ><span data-hk=0000000011000000000204b6750 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b6760 style="color:#61AFEF" > Component</span><span data-hk=0000000011000000000204b6770 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b6780 style="color:#E06C75;fontStyle:italic" >someProp</span><span data-hk=0000000011000000000204b6790 style="color:#ABB2BF" > }) {</span></span>
<span data-hk=0000000011000000000204b6820 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b6810 style="color:#7F848E;fontStyle:italic" >	// No error!</span></span>
<span data-hk=0000000011000000000204b6960 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b6830 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b6840 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b6850 style="color:#E5C07B" >state</span><span data-hk=0000000011000000000204b6860 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b6870 style="color:#E5C07B" >setState</span><span data-hk=0000000011000000000204b6880 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b6890 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b6900 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b6910 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b6920 style="color:#E06C75" >someProp</span><span data-hk=0000000011000000000204b6930 style="color:#ABB2BF" >, [</span><span data-hk=0000000011000000000204b6940 style="color:#E06C75" >someProp</span><span data-hk=0000000011000000000204b6950 style="color:#ABB2BF" >]);</span></span>
<span data-hk=0000000011000000000204b6980 data-line="" ><span data-hk=0000000011000000000204b6970 style="color:#ABB2BF" >	...</span></span>
<span data-hk=0000000011000000000204b7000 data-line="" ><span data-hk=0000000011000000000204b6990 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b7060 >There's a lot of precedent to draw from with how dependency arrays for <code data-hk=0000000011000000000204b7040 >useMemo</code> and <code data-hk=0000000011000000000204b7050 >useEffect</code> work. We'd probably want to inherit the same ESLint warnings and autofixes, and have the React Compiler auto-generate dependencies in the same way.</p>
<p data-hk=0000000011000000000204b7080 >Of course, we wouldn't want to fully follow <code data-hk=0000000011000000000204b7070 >useEffect</code>'s precedent and have the absence of a dependency array re-create state on each render. A missing dependency array here should behave the same as an empty one, which also means code like this is still perfectly valid:</p>
<figure data-hk=0000000011000000000204b7350 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b7340 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="js" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b7330 data-language="js" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b7140 data-line="" ><span data-hk=0000000011000000000204b7090 style="color:#C678DD" >function</span><span data-hk=0000000011000000000204b7100 style="color:#61AFEF" > Component</span><span data-hk=0000000011000000000204b7110 style="color:#ABB2BF" >({ </span><span data-hk=0000000011000000000204b7120 style="color:#E06C75;fontStyle:italic" >someProp</span><span data-hk=0000000011000000000204b7130 style="color:#ABB2BF" > }) {</span></span>
<span data-hk=0000000011000000000204b7160 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b7150 style="color:#7F848E;fontStyle:italic" >	// No error - we're not deriving state from anything mutable.</span></span>
<span data-hk=0000000011000000000204b7280 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b7170 style="color:#C678DD" >	const</span><span data-hk=0000000011000000000204b7180 style="color:#ABB2BF" > [</span><span data-hk=0000000011000000000204b7190 style="color:#E5C07B" >state</span><span data-hk=0000000011000000000204b7200 style="color:#ABB2BF" >, </span><span data-hk=0000000011000000000204b7210 style="color:#E5C07B" >setState</span><span data-hk=0000000011000000000204b7220 style="color:#ABB2BF" >] </span><span data-hk=0000000011000000000204b7230 style="color:#56B6C2" >=</span><span data-hk=0000000011000000000204b7240 style="color:#61AFEF" > useState</span><span data-hk=0000000011000000000204b7250 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b7260 style="color:#D19A66" >0</span><span data-hk=0000000011000000000204b7270 style="color:#ABB2BF" >);</span></span>
<span data-hk=0000000011000000000204b7300 data-line="" ><span data-hk=0000000011000000000204b7290 style="color:#ABB2BF" >	...</span></span>
<span data-hk=0000000011000000000204b7320 data-line="" ><span data-hk=0000000011000000000204b7310 style="color:#ABB2BF" >}</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b7380 >I'm not trying to entirely rule out having <code data-hk=0000000011000000000204b7360 >useState</code> <em data-hk=0000000011000000000204b7370 >not</em> reset when something it depends on changes. You'd still have the option of lying to the dependency array like with other hooks:</p>
<figure data-hk=0000000011000000000204b7480 data-rehype-pretty-code-figure="" ><pre data-hk=0000000011000000000204b7470 style="backgroundColor:#282c34;color:#abb2bf" tabIndex="0" data-language="javascript" data-theme="one-dark-pro" ><code data-hk=0000000011000000000204b7460 data-language="javascript" data-theme="one-dark-pro" style="display:grid" ><span data-hk=0000000011000000000204b7400 data-line="" data-highlighted-line="" ><span data-hk=0000000011000000000204b7390 style="color:#7F848E;fontStyle:italic" >// eslint-disable-next-line react-hooks/exhaustive-deps</span></span>
<span data-hk=0000000011000000000204b7450 data-line="" ><span data-hk=0000000011000000000204b7410 style="color:#61AFEF" >useState</span><span data-hk=0000000011000000000204b7420 style="color:#ABB2BF" >(</span><span data-hk=0000000011000000000204b7430 style="color:#E06C75" >someProp</span><span data-hk=0000000011000000000204b7440 style="color:#ABB2BF" >, []);</span></span></code></pre></figure>
<p data-hk=0000000011000000000204b7490 >...which in my opinion, is a much simpler escape hatch than what it takes to get the behaviour that's more "correct" today.</p></div><div style="display:none"><!--$-->use_state_should_require_a_dependency_array<!--/--><!--$-->1<!--/-->more:<!--$--><!--/--><!--$--><!--/--></div></div></div><!--!$/e000000--></div><!--$--><script>window.manifest = {"src/routes/(index)/index.tsx?pick=default&pick=$css":{"output":"/_build/assets/index-kkivAnk3.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/all_posts.compile-uYno7xFZ.js","key":"/_build/assets/all_posts.compile-uYno7xFZ.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-kkivAnk3.js","key":"/_build/assets/index-kkivAnk3.js","rel":"modulepreload"}}]},"src/routes/[...404].tsx?pick=default&pick=$css":{"output":"/_build/assets/_...404_-C_tTzJ3W.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/_...404_-C_tTzJ3W.js","key":"/_build/assets/_...404_-C_tTzJ3W.js","rel":"modulepreload"}}]},"src/routes/client-routing-test/[param].tsx?pick=default&pick=$css":{"output":"/_build/assets/_param_-CwMtWqOG.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/_param_-CwMtWqOG.js","key":"/_build/assets/_param_-CwMtWqOG.js","rel":"modulepreload"}}]},"src/routes/posts/___template/index.tsx?pick=default&pick=$css":{"output":"/_build/assets/index-BdPEZguX.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CCakz991.css","key":"/_build/assets/jsx-runtime-CCakz991.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/all_posts.compile-uYno7xFZ.js","key":"/_build/assets/all_posts.compile-uYno7xFZ.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CwYC41Ck.js","key":"/_build/assets/jsx-runtime-CwYC41Ck.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-BdPEZguX.js","key":"/_build/assets/index-BdPEZguX.js","rel":"modulepreload"}}]},"src/routes/posts/___template/meta.ts?pick=default&pick=$css":{"output":"/_build/assets/meta-PUbtxr7Y.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/meta-PUbtxr7Y.js","key":"/_build/assets/meta-PUbtxr7Y.js","rel":"modulepreload"}}]},"src/routes/posts/_how-those-daily-puzzle-games-work/index.tsx?pick=default&pick=$css":{"output":"/_build/assets/index-BtaoTybc.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CCakz991.css","key":"/_build/assets/jsx-runtime-CCakz991.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/all_posts.compile-uYno7xFZ.js","key":"/_build/assets/all_posts.compile-uYno7xFZ.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CwYC41Ck.js","key":"/_build/assets/jsx-runtime-CwYC41Ck.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-BtaoTybc.js","key":"/_build/assets/index-BtaoTybc.js","rel":"modulepreload"}}]},"src/routes/posts/_how-those-daily-puzzle-games-work/meta.ts?pick=default&pick=$css":{"output":"/_build/assets/meta-CErcayRg.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/meta-CErcayRg.js","key":"/_build/assets/meta-CErcayRg.js","rel":"modulepreload"}}]},"src/routes/posts/_how_this_blog_works/index.tsx?pick=default&pick=$css":{"output":"/_build/assets/index-CVpQH7ny.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CCakz991.css","key":"/_build/assets/jsx-runtime-CCakz991.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/all_posts.compile-uYno7xFZ.js","key":"/_build/assets/all_posts.compile-uYno7xFZ.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CwYC41Ck.js","key":"/_build/assets/jsx-runtime-CwYC41Ck.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/preload-helper-ug3pwPZ1.js","key":"/_build/assets/preload-helper-ug3pwPZ1.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/embed_react_component-CqJ3mHPT.js","key":"/_build/assets/embed_react_component-CqJ3mHPT.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CVpQH7ny.js","key":"/_build/assets/index-CVpQH7ny.js","rel":"modulepreload"}}]},"src/routes/posts/_how_this_blog_works/meta.ts?pick=default&pick=$css":{"output":"/_build/assets/meta-BJNXyS_V.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/meta-BJNXyS_V.js","key":"/_build/assets/meta-BJNXyS_V.js","rel":"modulepreload"}}]},"src/routes/posts/_my-time-with-solid-start/index.tsx?pick=default&pick=$css":{"output":"/_build/assets/index-DxNEBv0f.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CCakz991.css","key":"/_build/assets/jsx-runtime-CCakz991.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/all_posts.compile-uYno7xFZ.js","key":"/_build/assets/all_posts.compile-uYno7xFZ.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CwYC41Ck.js","key":"/_build/assets/jsx-runtime-CwYC41Ck.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-DxNEBv0f.js","key":"/_build/assets/index-DxNEBv0f.js","rel":"modulepreload"}}]},"src/routes/posts/_my-time-with-solid-start/meta.ts?pick=default&pick=$css":{"output":"/_build/assets/meta-FfsHJZ1O.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/meta-FfsHJZ1O.js","key":"/_build/assets/meta-FfsHJZ1O.js","rel":"modulepreload"}}]},"src/routes/posts/_one/index.tsx?pick=default&pick=$css":{"output":"/_build/assets/index-CxAMWWSc.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CCakz991.css","key":"/_build/assets/jsx-runtime-CCakz991.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/all_posts.compile-uYno7xFZ.js","key":"/_build/assets/all_posts.compile-uYno7xFZ.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CwYC41Ck.js","key":"/_build/assets/jsx-runtime-CwYC41Ck.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxAMWWSc.js","key":"/_build/assets/index-CxAMWWSc.js","rel":"modulepreload"}}]},"src/routes/posts/_one/meta.ts?pick=default&pick=$css":{"output":"/_build/assets/meta-BqrlQWg9.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/meta-BqrlQWg9.js","key":"/_build/assets/meta-BqrlQWg9.js","rel":"modulepreload"}}]},"src/routes/posts/_two/index.tsx?pick=default&pick=$css":{"output":"/_build/assets/index-BQdAW6Sp.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CCakz991.css","key":"/_build/assets/jsx-runtime-CCakz991.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/all_posts.compile-uYno7xFZ.js","key":"/_build/assets/all_posts.compile-uYno7xFZ.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CwYC41Ck.js","key":"/_build/assets/jsx-runtime-CwYC41Ck.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-BQdAW6Sp.js","key":"/_build/assets/index-BQdAW6Sp.js","rel":"modulepreload"}}]},"src/routes/posts/_two/meta.ts?pick=default&pick=$css":{"output":"/_build/assets/meta-DtkNl46x.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/meta-DtkNl46x.js","key":"/_build/assets/meta-DtkNl46x.js","rel":"modulepreload"}}]},"src/routes/posts/_two/shouldnotappear/meta.ts?pick=default&pick=$css":{"output":"/_build/assets/meta-BAGqRHE7.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/meta-BAGqRHE7.js","key":"/_build/assets/meta-BAGqRHE7.js","rel":"modulepreload"}}]},"src/routes/posts/use_state_should_require_a_dependency_array/index.tsx?pick=default&pick=$css":{"output":"/_build/assets/index-BDpVB2cY.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/index-B0zURUJ_.css","key":"/_build/assets/index-B0zURUJ_.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CCakz991.css","key":"/_build/assets/jsx-runtime-CCakz991.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/all_posts.compile-uYno7xFZ.js","key":"/_build/assets/all_posts.compile-uYno7xFZ.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/components-Dezfg5Cr.js","key":"/_build/assets/components-Dezfg5Cr.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/jsx-runtime-CwYC41Ck.js","key":"/_build/assets/jsx-runtime-CwYC41Ck.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/preload-helper-ug3pwPZ1.js","key":"/_build/assets/preload-helper-ug3pwPZ1.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/embed_react_component-CqJ3mHPT.js","key":"/_build/assets/embed_react_component-CqJ3mHPT.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-BDpVB2cY.js","key":"/_build/assets/index-BDpVB2cY.js","rel":"modulepreload"}}]},"src/routes/posts/use_state_should_require_a_dependency_array/meta.ts?pick=default&pick=$css":{"output":"/_build/assets/meta-C8bFo_u0.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/meta-C8bFo_u0.js","key":"/_build/assets/meta-C8bFo_u0.js","rel":"modulepreload"}}]},"virtual:$vinxi/handler/client":{"output":"/_build/assets/client-naLqGCVE.js","assets":[{"tag":"link","attrs":{"href":"/_build/assets/client-B_JNecB5.css","key":"/_build/assets/client-B_JNecB5.css","rel":"stylesheet","fetchPriority":"high"}},{"tag":"link","attrs":{"href":"/_build/assets/web-DYO1r_n-.js","key":"/_build/assets/web-DYO1r_n-.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/preload-helper-ug3pwPZ1.js","key":"/_build/assets/preload-helper-ug3pwPZ1.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/index-CxeZ2ADl.js","key":"/_build/assets/index-CxeZ2ADl.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/routing-CouTEQdE.js","key":"/_build/assets/routing-CouTEQdE.js","rel":"modulepreload"}},{"tag":"link","attrs":{"href":"/_build/assets/client-naLqGCVE.js","key":"/_build/assets/client-naLqGCVE.js","rel":"modulepreload"}}]}}</script><script type="module" async src="/_build/assets/client-naLqGCVE.js"></script><!--/--></body></html>