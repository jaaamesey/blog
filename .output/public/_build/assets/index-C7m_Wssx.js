const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react_bad.react-C_OzqwXq.js","assets/index-BJfUAbRs.js"])))=>i.map(i=>d[i]);
import{d as n,M as l,h as y,P as B}from"./jsx-runtime-CwYC41Ck.js";import{_ as o}from"./preload-helper-ug3pwPZ1.js";import{E as a}from"./embed_react_component-CqJ3mHPT.js";import{i as u,t as g,w as m,l as F,x as f,y as A,b as c}from"./web-DYO1r_n-.js";import"./all_posts.compile-uYno7xFZ.js";import"./index-CxeZ2ADl.js";import"./routing-CouTEQdE.js";import"./components-Dezfg5Cr.js";const C="_demoWrapper_ksh75_1",b={demoWrapper:C};var E=g("<div><noscript></noscript><!$><!/>");function s(r){return(()=>{var e=u(E),t=e.firstChild,d=t.nextSibling,[h,p]=m(d.nextSibling);return F(e,()=>r.children,h,p),f(()=>A(e,`w-full bg-white text-black p-4 rounded-lg ${b.demoWrapper}`)),e})()}function i(r){const e={a:"a",code:"code",em:"em",figure:"figure",h2:"h2",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...r.components};return l(y,{children:[l(e.p,{children:["React has a wonderful hook called ",n(e.a,{href:"https://react.dev/reference/react/useState",children:n(e.code,{children:"useState"})})," that we use to set and listen to things that might change over time."]}),`
`,n(e.p,{children:"There's a few points I'd like to argue here."}),`
`,l(e.p,{children:["1. ",l(e.strong,{children:["Using ",n(e.code,{children:"useState"})," like this is bad, and should throw a lint error"]}),":"]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"ts","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"ts","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" Component"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:" }) {"})]}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// ESLint error: initial state depends on a mutable value"})}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"state"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setState"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	..."})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,l(e.p,{children:["2. ",l(e.strong,{children:["Derived state is ",n(e.em,{children:"sometimes"})," a valid approach to solving a problem"]}),", but ",n(e.strong,{children:"the escape hatches React suggests can be somewhat invasive and error-prone"}),"."]}),`
`,l(e.p,{children:["3. ",l(e.strong,{children:['The "right" primitive for this would be a ',n(e.code,{children:"useState"})," hook that requires a dependency array"]}),". The title. We'll get to that eventually."]}),`
`,n(e.p,{children:"Let's get started."}),`
`,n(e.p,{children:l(e.em,{children:["Edit (31/05/25): I'm using ",l(e.a,{href:"https://react.dev/reference/react-dom/components/input#controlling-an-input-with-a-state-variable",children:[n(e.em,{children:"controlled"})," inputs"]})," throughout this article, but you'll find that a similar issue actually comes up with ",l(e.a,{href:"https://stackoverflow.com/questions/30727837/change-input-defaultvalue-by-passing-props",children:["using ",n(e.code,{children:"defaultValue"})," for ",n(e.em,{children:"uncontrolled"})," inputs"]}),"!"]})}),`
`,n(e.h2,{children:"1. useState as it exists now should not allow derived state"}),`
`,n(e.p,{children:"So, about that lint error I suggested. Maybe you've already identified the issue with the code above. If not, hopefully this demo illustrates it better:"}),`
`,n(s,{children:n(a,{loader:()=>o(()=>import("./react_bad.react-C_OzqwXq.js"),__vite__mapDeps([0,1])).then(t=>t.BadTodoApp1)})}),`
`,l(e.p,{children:['When you change the "task" being edited, ',n(e.strong,{children:"the text in the input doesn't change to whatever the title for the new task is for."})]}),`
`,n(e.p,{children:`But the text for the previous task you were editing before isn't relevant to the task you're editing now, right? Wouldn't you expect it to "reset" with the rest of the UI?`}),`
`,n(e.p,{children:"Let's see if anything familiar comes up in the code for that edit panel:"}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"jsx","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"jsx","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" EditPanel"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"saveName"}),n(e.span,{style:{color:"#ABB2BF"},children:" }) {"})]}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// This isn't reset when `item.name` changes!"})}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setName"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E5C07B"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	return"}),n(e.span,{style:{color:"#ABB2BF"},children:" ("})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#ABB2BF"},children:"		<"}),n(e.span,{style:{color:"#E06C75"},children:"div"}),n(e.span,{style:{color:"#ABB2BF"},children:">"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#ABB2BF"},children:"			<"}),n(e.span,{style:{color:"#E06C75"},children:"input"}),n(e.span,{style:{color:"#D19A66",fontStyle:"italic"},children:" value"}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#C678DD"},children:"{"}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#C678DD"},children:"}"}),n(e.span,{style:{color:"#D19A66",fontStyle:"italic"},children:" onChange"}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#C678DD"},children:"{"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"e"}),n(e.span,{style:{color:"#ABB2BF"},children:") "}),n(e.span,{style:{color:"#C678DD"},children:"=>"}),n(e.span,{style:{color:"#61AFEF"},children:" setName"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E5C07B"},children:"e"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E5C07B"},children:"target"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"value"}),n(e.span,{style:{color:"#ABB2BF"},children:")"}),n(e.span,{style:{color:"#C678DD"},children:"}"}),n(e.span,{style:{color:"#ABB2BF"},children:" />"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#ABB2BF"},children:"			<"}),n(e.span,{style:{color:"#E06C75"},children:"button"}),n(e.span,{style:{color:"#D19A66",fontStyle:"italic"},children:" onClick"}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#C678DD"},children:"{"}),n(e.span,{style:{color:"#ABB2BF"},children:"() "}),n(e.span,{style:{color:"#C678DD"},children:"=>"}),n(e.span,{style:{color:"#61AFEF"},children:" saveName"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:")"}),n(e.span,{style:{color:"#C678DD"},children:"}"}),n(e.span,{style:{color:"#ABB2BF"},children:">Save</"}),n(e.span,{style:{color:"#E06C75"},children:"button"}),n(e.span,{style:{color:"#ABB2BF"},children:">"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#ABB2BF"},children:"		</"}),n(e.span,{style:{color:"#E06C75"},children:"div"}),n(e.span,{style:{color:"#ABB2BF"},children:">"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	);"})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,n(e.p,{children:l(e.strong,{children:["What we've done here is create ",n(e.em,{children:"un"}),"-reactive code by accident."]})}),`
`,l(e.p,{children:["Ideally, components should be dealing with the reality that a prop can change over time. But instead, we're taking a snapshot of only the ",n(e.em,{children:"initial"})," value of a prop, and ignoring any changes."]}),`
`,l(e.p,{children:["It's a ",n(e.a,{href:"https://stackoverflow.com/questions/58288286/what-is-derived-state-in-react-and-why-is-it-important",children:"fairly common position"})," that deriving ",n(e.em,{children:"any"})," mutable state from other state should be avoided where possible. In other words, you shouldn't be able to put a prop or some other piece of state inside a ",n(e.code,{children:"useState"})," call. And I'd agree to an extent - so much so that I think that piece of code should warrant the death penalty, or at least a warning from ESLint. But there's no such warning, and I haven't been strapped to the electric chair just yet."]}),`
`,n(e.p,{children:"I've seen this problem come up way too often in production, and it's in no way exclusive to React - it's the reality of any moving part that is tied to another moving part, but also needs to move on its own for a while. You'll find the same problem in SolidJS, except..."}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"js","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"js","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" SolidComponent"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"props"}),n(e.span,{style:{color:"#ABB2BF"},children:") {"})]}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// ESLint error: The reactive variable 'props.someProp' should be used within JSX, a tracked scope (like"})}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// createEffect), or inside an event handler function, or else changes will be ignored."})}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"state"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setState"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" createSignal"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E5C07B"},children:"props"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,l(e.p,{children:["...Solid's recommended ESLint config ",n(e.em,{children:"does"})," fire a warning for this!"]}),`
`,n(e.p,{children:"So, I don't really see a reason why React's ESLint config shouldn't prohibit this."}),`
`,n(e.h2,{children:"2. The unpleasant workarounds for derived state"}),`
`,l(e.p,{children:["React offers a few solutions to this problem, both in the old ",n(e.a,{href:"https://legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html",children:`"You Probably Don't Need Derived State"`})," article (pre-hooks!), and in the ",n(e.a,{href:"https://react.dev/reference/react/useState#resetting-state-with-a-key",children:"way more recent article on useState"}),"."]}),`
`,l(e.p,{children:["First, if the derived state you're creating is read-only, i.e. is only written to when the source state changes - you don't need ",n(e.code,{children:"useState"})," at all. You can just compute it directly like so:"]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"js","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"js","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" Component"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"a"}),n(e.span,{style:{color:"#ABB2BF"},children:" }) {"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"b"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setB"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#D19A66"},children:"0"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#E5C07B"},children:" sum"}),n(e.span,{style:{color:"#56B6C2"},children:" ="}),n(e.span,{style:{color:"#E06C75"},children:" a"}),n(e.span,{style:{color:"#56B6C2"},children:" +"}),n(e.span,{style:{color:"#E06C75"},children:" b"}),n(e.span,{style:{color:"#ABB2BF"},children:";"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	..."})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,l(e.p,{children:["Or, if you really don't want to re-compute it each render, and aren't using the new ",n(e.a,{href:"https://react.dev/learn/react-compiler",children:"React Compiler"}),", there's ",n(e.code,{children:"useMemo"}),":"]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"js","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"js","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" Component"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"a"}),n(e.span,{style:{color:"#ABB2BF"},children:" }) {"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"b"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setB"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#D19A66"},children:"0"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#E5C07B"},children:" sum"}),n(e.span,{style:{color:"#56B6C2"},children:" ="}),n(e.span,{style:{color:"#61AFEF"},children:" useMemo"}),n(e.span,{style:{color:"#ABB2BF"},children:"(() "}),n(e.span,{style:{color:"#C678DD"},children:"=>"}),n(e.span,{style:{color:"#E06C75"},children:" a"}),n(e.span,{style:{color:"#56B6C2"},children:" +"}),n(e.span,{style:{color:"#E06C75"},children:" b"}),n(e.span,{style:{color:"#ABB2BF"},children:", ["}),n(e.span,{style:{color:"#E06C75"},children:"a"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E06C75"},children:"b"}),n(e.span,{style:{color:"#ABB2BF"},children:"]);"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	..."})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,l(e.p,{children:["It's the cases that can't be represented this way - cases that need ",n(e.em,{children:"mutable"})," derived state - that get really messy. This tends to come up a lot when dealing with user input and optimistic updates (if you can't use ",n(e.a,{href:"https://react.dev/reference/react/useOptimistic",children:n(e.code,{children:"useOptimistic"})})," or ",n(e.a,{href:"https://tanstack.com/query/latest",children:"Tanstack Query"})," for whatever reason)."]}),`
`,l(e.p,{children:["Let's go back to the todo list example from before. The textbook way of fixing this is through the ",n(e.code,{children:"key"})," prop, which exists on every React component. So, let's add that to where this component is used:"]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"jsx","data-theme":"one-dark-pro",children:n(e.code,{"data-language":"jsx","data-theme":"one-dark-pro",style:{display:"grid"},children:l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#ABB2BF"},children:"<"}),n(e.span,{style:{color:"#E5C07B"},children:"EditPanel"}),n(e.span,{style:{color:"#D19A66",fontStyle:"italic"},children:" item"}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#C678DD"},children:"{"}),n(e.span,{style:{color:"#E06C75"},children:"items"}),n(e.span,{style:{color:"#ABB2BF"},children:"["}),n(e.span,{style:{color:"#E06C75"},children:"selectedItemId"}),n(e.span,{style:{color:"#ABB2BF"},children:"]"}),n(e.span,{style:{color:"#C678DD"},children:"}"}),n(e.span,{style:{color:"#D19A66",fontStyle:"italic"},children:" key"}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#C678DD"},children:"{"}),n(e.span,{style:{color:"#E06C75"},children:"selectedItemId"}),n(e.span,{style:{color:"#C678DD"},children:"}"}),n(e.span,{style:{color:"#ABB2BF"},children:" />"})]})})})}),`
`,n(s,{children:n(a,{props:{enableDrawing:!1},loader:()=>o(()=>import("./react_bad.react-C_OzqwXq.js"),__vite__mapDeps([0,1])).then(t=>t.BadTodoAppWithKey)})}),`
`,n(e.p,{children:"And it works - the input field changes when we edit a new task!"}),`
`,l(e.p,{children:["But we have to be careful with this - what if there's still some state that we want to ",n(e.em,{children:"preserve"}),"?"]}),`
`,l(e.p,{children:["Call it contrived, but maybe we want to add ",n(e.em,{children:"drawings"})," to our tasks. With different brush colours."]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"js","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"js","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" EditPanel"}),n(e.span,{style:{color:"#ABB2BF"},children:"(...) {"})]}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"brushColor"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setBrushColor"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#98C379"},children:"'black'"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	..."})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,n(s,{children:n(a,{props:{enableDrawing:!0},loader:()=>o(()=>import("./react_bad.react-C_OzqwXq.js"),__vite__mapDeps([0,1])).then(t=>t.BadTodoAppWithKey)})}),`
`,n(e.p,{children:n(e.strong,{children:"Try changing the brush colour before selecting another task."})}),`
`,n(e.p,{children:"Why should the colour we're drawing with reset each time we change what task we're editing? That state might be part of the same component, but it shouldn't be joined to the specific task we're editing."}),`
`,l(e.p,{children:["If ",n(e.code,{children:"key"})," changes between renders, the entire component tree below that point is ",n(e.em,{children:'"remounted"'}),". That means that the underlying DOM nodes will be re-created, and that ",n(e.em,{children:"any"})," state declared below that point will be trashed and reset."]}),`
`,l(e.p,{children:["This is why we're now seeing that field reset as expected, and why we're seeing the chosen brush colour reset as ",n(e.em,{children:"not"})," expected. We can't just reset state at the level of a single ",n(e.code,{children:"useState"})," hook, or even a single component instance."]}),`
`,l(e.p,{children:["You might have also noticed that we're now passing on the responsibility of resetting this state to the ",n(e.em,{children:"consumer"})," of this component. What if we end up using it elsewhere, but forget to provide a ",n(e.code,{children:"key"})," prop? Also, what if you have more than one dependency that should cause a component to reset? You're going to need to merge those into a single key somehow."]}),`
`,l(e.p,{children:["So, sometimes forcing a remount with ",n(e.code,{children:"key"})," is absolutely the right option, but there's cases where it's too much of an ask."]}),`
`,l(e.p,{children:["For those cases, ",n(e.a,{href:"https://react.dev/reference/react/useState#storing-information-from-previous-renders",children:"the React docs provides a pattern that's a bit more isolated"}),":"]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"js","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"js","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"export"}),n(e.span,{style:{color:"#C678DD"},children:" default"}),n(e.span,{style:{color:"#C678DD"},children:" function"}),n(e.span,{style:{color:"#61AFEF"},children:" CountLabel"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"count"}),n(e.span,{style:{color:"#ABB2BF"},children:" }) {"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"  const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"prevCount"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setPrevCount"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75"},children:"count"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"  const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"trend"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setTrend"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#D19A66"},children:"null"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"  if"}),n(e.span,{style:{color:"#ABB2BF"},children:" ("}),n(e.span,{style:{color:"#E06C75"},children:"prevCount"}),n(e.span,{style:{color:"#56B6C2"},children:" !=="}),n(e.span,{style:{color:"#E06C75"},children:" count"}),n(e.span,{style:{color:"#ABB2BF"},children:") {"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#61AFEF"},children:"    setPrevCount"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75"},children:"count"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#61AFEF"},children:"    setTrend"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75"},children:"count"}),n(e.span,{style:{color:"#56B6C2"},children:" >"}),n(e.span,{style:{color:"#E06C75"},children:" prevCount"}),n(e.span,{style:{color:"#C678DD"},children:" ?"}),n(e.span,{style:{color:"#98C379"},children:" 'increasing'"}),n(e.span,{style:{color:"#C678DD"},children:" :"}),n(e.span,{style:{color:"#98C379"},children:" 'decreasing'"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"  }"})}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"  return"}),n(e.span,{style:{color:"#ABB2BF"},children:" ("})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"    <>"})}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#ABB2BF"},children:"      <"}),n(e.span,{style:{color:"#E06C75"},children:"h1"}),n(e.span,{style:{color:"#ABB2BF"},children:">"}),n(e.span,{style:{color:"#C678DD"},children:"{"}),n(e.span,{style:{color:"#E06C75"},children:"count"}),n(e.span,{style:{color:"#C678DD"},children:"}"}),n(e.span,{style:{color:"#ABB2BF"},children:"</"}),n(e.span,{style:{color:"#E06C75"},children:"h1"}),n(e.span,{style:{color:"#ABB2BF"},children:">"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"      {"}),n(e.span,{style:{color:"#E06C75"},children:"trend"}),n(e.span,{style:{color:"#56B6C2"},children:" &&"}),n(e.span,{style:{color:"#ABB2BF"},children:" <"}),n(e.span,{style:{color:"#E06C75"},children:"p"}),n(e.span,{style:{color:"#ABB2BF"},children:">The count is "}),n(e.span,{style:{color:"#C678DD"},children:"{"}),n(e.span,{style:{color:"#E06C75"},children:"trend"}),n(e.span,{style:{color:"#C678DD"},children:"}"}),n(e.span,{style:{color:"#ABB2BF"},children:"</"}),n(e.span,{style:{color:"#E06C75"},children:"p"}),n(e.span,{style:{color:"#ABB2BF"},children:">"}),n(e.span,{style:{color:"#C678DD"},children:"}"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"    </>"})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"  );"})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,l(e.p,{children:["The nicest thing I can say about this is that it works - this ",n(e.em,{children:"would"})," force only the state we specify to reset. And at the very least, React ",n(e.em,{children:"does"})," prevent Effects from running and children from re-rendering if all a render here does is trigger another render."]}),`
`,l(e.p,{children:["But despite this pattern only being applied to ",n(e.em,{children:"one"})," value, it already looks quite janky. We now have to manage previous state, and there's a lot of room for things to go wrong. Maybe our condition gets us stuck in an infinite loop, or maybe we accidentally omit a dependency that we should be listening to."]}),`
`,l(e.p,{children:["Now, what I've seen more in practice is code that looks like this, which definitely ",n(e.em,{children:"seems"})," more elegant:"]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"jsx","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"jsx","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" EditPanel"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:", ... }) {"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setName"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E5C07B"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#61AFEF"},children:"	useEffect"}),n(e.span,{style:{color:"#ABB2BF"},children:"(() "}),n(e.span,{style:{color:"#C678DD"},children:"=>"}),n(e.span,{style:{color:"#ABB2BF"},children:" {"})]}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#61AFEF"},children:"		setName"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E5C07B"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#ABB2BF"},children:"	}, ["}),n(e.span,{style:{color:"#E5C07B"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:"]);"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"..."})})]})})}),`
`,n(e.p,{children:"But this introduces an unnecessary re-render. What's even worse is the fact that the first re-render has a mix of stale and non-stale data, leading to potentially dangerous behaviour with other useEffects:"}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"jsx","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"jsx","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" EditPanel"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:", ... }) {"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"..."})}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#61AFEF"},children:"	useEffect"}),n(e.span,{style:{color:"#ABB2BF"},children:"(() "}),n(e.span,{style:{color:"#C678DD"},children:"=>"}),n(e.span,{style:{color:"#ABB2BF"},children:" {"})]}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#E5C07B"},children:"		someDatabase"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#61AFEF"},children:"sync"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75"},children:"id"}),n(e.span,{style:{color:"#ABB2BF"},children:": "}),n(e.span,{style:{color:"#E5C07B"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"id"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:" });"})]}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#ABB2BF"},children:"	}, ["}),n(e.span,{style:{color:"#E5C07B"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"id"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:"]);"})]}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// Runs twice when item.id changes:"})}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// 1. someDatabase.sync({ id: 'Second item ID', name: 'First item name' }) (incorrect!)"})}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// 2. someDatabase.sync({ id: 'Second item ID', name: 'Second item name' })"})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"..."})}),`
`,n(e.span,{"data-line":"",children:" "})]})})}),`
`,n(e.h2,{children:"3. Better primitives for mutable derived state"}),`
`,l(e.p,{children:["In my opinion, these workarounds are far more complex than just having proper tools for mutable derived state. And these days, at least ",n(e.a,{href:"https://svelte.dev/docs/svelte/$derived",children:"Svelte"})," and ",n(e.a,{href:"https://dev.to/this-is-learning/mutable-derivations-in-reactivity-2ffl",children:"SolidJS"})," seem to agree."]}),`
`,l(e.p,{children:["Let's look at the ",n(e.code,{children:"createWritable"}),' "hook" being proposed for Solid. Its implementation is actually fairly simple, and reveals a lot about its expected behaviour.']}),`
`,n(e.p,{children:"Some context:"}),`
`,l(e.ul,{children:[`
`,l(e.li,{children:['Solid components only render once, so instead of "hooks" you just have factory functions that usually start with ',n(e.code,{children:"create"}),"."]}),`
`,l(e.li,{children:[n(e.code,{children:"createSignal"})," is basically just ",n(e.code,{children:"useState"}),"."]}),`
`,l(e.li,{children:[n(e.code,{children:"createMemo"})," is basically just ",n(e.code,{children:"useMemo"}),", but automatically derives its dependencies instead of requiring a dependency array."]}),`
`]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"js","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"js","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" createWritable"}),n(e.span,{style:{color:"#ABB2BF"},children:"("})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:'	// Function for computing "initial" state'})}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"	fn"}),n(e.span,{style:{color:"#ABB2BF"},children:","})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:") {"})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"  // When dependencies used by `fn` change, the memoized state is "})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"  // discarded and recomputed"})}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"  const"}),n(e.span,{style:{color:"#E5C07B"},children:" computed"}),n(e.span,{style:{color:"#56B6C2"},children:" ="}),n(e.span,{style:{color:"#61AFEF"},children:" createMemo"}),n(e.span,{style:{color:"#ABB2BF"},children:"(() "}),n(e.span,{style:{color:"#C678DD"},children:"=>"}),n(e.span,{style:{color:"#61AFEF"},children:" createSignal"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#61AFEF"},children:"fn"}),n(e.span,{style:{color:"#ABB2BF"},children:"()))"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"  // This looks scary, but it's basically just returning the getters"})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"  // and setters from the state declared above"})}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"  return"}),n(e.span,{style:{color:"#ABB2BF"},children:" [() "}),n(e.span,{style:{color:"#C678DD"},children:"=>"}),n(e.span,{style:{color:"#61AFEF"},children:" computed"}),n(e.span,{style:{color:"#ABB2BF"},children:"()["}),n(e.span,{style:{color:"#D19A66"},children:"0"}),n(e.span,{style:{color:"#ABB2BF"},children:"](), ("}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"v"}),n(e.span,{style:{color:"#ABB2BF"},children:") "}),n(e.span,{style:{color:"#C678DD"},children:"=>"}),n(e.span,{style:{color:"#61AFEF"},children:" computed"}),n(e.span,{style:{color:"#ABB2BF"},children:"()["}),n(e.span,{style:{color:"#D19A66"},children:"1"}),n(e.span,{style:{color:"#ABB2BF"},children:"]("}),n(e.span,{style:{color:"#E06C75"},children:"v"}),n(e.span,{style:{color:"#ABB2BF"},children:"))]"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,l(e.p,{children:["What this returns is state that is ",n(e.em,{children:"memoized"})," by whatever dependencies were used to create that state. Just like Svelte's ",n(e.code,{children:"$derived"}),", that state can change over the lifetime of its dependencies - but once one of those dependencies changes, that state is trashed and re-computed."]}),`
`,l(e.p,{children:["I'm only using Solid's implementation as an example here because implementing a hook like this in React is actually quite annoying. For starters, ",n(e.a,{href:"https://react.dev/reference/rules/rules-of-hooks#only-call-hooks-at-the-top-level",children:"Rules of Hooks"})," prevents you from nesting a ",n(e.code,{children:"useState"})," inside a ",n(e.code,{children:"useMemo"}),"."]}),`
`,l(e.p,{children:["But React implementations of this concept do exist, such as ",n(e.a,{href:"https://react.dev/reference/react/useState#storing-information-from-previous-renders",children:"use-state-with-deps"}),". Let's give it a shot."]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"jsx","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"jsx","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"import"}),n(e.span,{style:{color:"#ABB2BF"},children:" { "}),n(e.span,{style:{color:"#E06C75"},children:"useStateWithDeps"}),n(e.span,{style:{color:"#C678DD"},children:" as"}),n(e.span,{style:{color:"#E06C75"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:" } "}),n(e.span,{style:{color:"#C678DD"},children:"from"}),n(e.span,{style:{color:"#98C379"},children:" 'use-state-with-deps'"}),n(e.span,{style:{color:"#ABB2BF"},children:";"})]}),`
`,n(e.span,{"data-line":"",children:" "}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" EditPanel"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:", ... }) {"})]}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setName"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E5C07B"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:"."}),n(e.span,{style:{color:"#E06C75"},children:"name"}),n(e.span,{style:{color:"#ABB2BF"},children:", ["}),n(e.span,{style:{color:"#E06C75"},children:"item"}),n(e.span,{style:{color:"#ABB2BF"},children:"]);"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	..."})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,n(s,{children:n(a,{props:{enableDrawing:!0},loader:()=>o(()=>import("./react_bad.react-C_OzqwXq.js"),__vite__mapDeps([0,1])).then(t=>t.BadTodoAppWithDeps)})}),`
`,l(e.p,{children:["No messing with ",n(e.code,{children:"key"}),", weird setter calls in the render method, or ",n(e.code,{children:"useEffect"})," - it just kinda works."]}),`
`,l(e.p,{children:["What I'm proposing is that ",l(e.strong,{children:["this becomes how ",n(e.code,{children:"useState"})," works by default"]}),"."]}),`
`,n(e.p,{children:"Remember that ESLint error I proposed further up? Maybe it should look more like this:"}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"ts","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"ts","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" Component"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:" }) {"})]}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// ESLint error: someProp not specified in dependency array"})}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"state"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setState"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	..."})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,n(e.p,{children:"...and be fixed like so:"}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"js","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"js","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" Component"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:" }) {"})]}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// No error!"})}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"state"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setState"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:", ["}),n(e.span,{style:{color:"#E06C75"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:"]);"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	..."})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,l(e.p,{children:["There's a lot of precedent to draw from with how dependency arrays for ",n(e.code,{children:"useMemo"})," and ",n(e.code,{children:"useEffect"})," work. We'd probably want to inherit the same ESLint warnings and autofixes, and have the React Compiler auto-generate dependencies in the same way."]}),`
`,l(e.p,{children:["Of course, we wouldn't want to fully follow ",n(e.code,{children:"useEffect"}),"'s precedent and have the absence of a dependency array re-create state on each render. A missing dependency array here should behave the same as an empty one, which also means code like this is still perfectly valid:"]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"js","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"js","data-theme":"one-dark-pro",style:{display:"grid"},children:[l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"function"}),n(e.span,{style:{color:"#61AFEF"},children:" Component"}),n(e.span,{style:{color:"#ABB2BF"},children:"({ "}),n(e.span,{style:{color:"#E06C75",fontStyle:"italic"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:" }) {"})]}),`
`,n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"	// No error - we're not deriving state from anything mutable."})}),`
`,l(e.span,{"data-line":"","data-highlighted-line":"",children:[n(e.span,{style:{color:"#C678DD"},children:"	const"}),n(e.span,{style:{color:"#ABB2BF"},children:" ["}),n(e.span,{style:{color:"#E5C07B"},children:"state"}),n(e.span,{style:{color:"#ABB2BF"},children:", "}),n(e.span,{style:{color:"#E5C07B"},children:"setState"}),n(e.span,{style:{color:"#ABB2BF"},children:"] "}),n(e.span,{style:{color:"#56B6C2"},children:"="}),n(e.span,{style:{color:"#61AFEF"},children:" useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#D19A66"},children:"0"}),n(e.span,{style:{color:"#ABB2BF"},children:");"})]}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"	..."})}),`
`,n(e.span,{"data-line":"",children:n(e.span,{style:{color:"#ABB2BF"},children:"}"})})]})})}),`
`,l(e.p,{children:["I'm not trying to entirely rule out having ",n(e.code,{children:"useState"})," ",n(e.em,{children:"not"})," reset when something it depends on changes. You'd still have the option of lying to the dependency array like with other hooks:"]}),`
`,n(e.figure,{"data-rehype-pretty-code-figure":"",children:n(e.pre,{style:{backgroundColor:"#282c34",color:"#abb2bf"},tabIndex:"0","data-language":"javascript","data-theme":"one-dark-pro",children:l(e.code,{"data-language":"javascript","data-theme":"one-dark-pro",style:{display:"grid"},children:[n(e.span,{"data-line":"","data-highlighted-line":"",children:n(e.span,{style:{color:"#7F848E",fontStyle:"italic"},children:"// eslint-disable-next-line react-hooks/exhaustive-deps"})}),`
`,l(e.span,{"data-line":"",children:[n(e.span,{style:{color:"#61AFEF"},children:"useState"}),n(e.span,{style:{color:"#ABB2BF"},children:"("}),n(e.span,{style:{color:"#E06C75"},children:"someProp"}),n(e.span,{style:{color:"#ABB2BF"},children:", []);"})]})]})})}),`
`,n(e.p,{children:`...which in my opinion, is a much simpler escape hatch than what it takes to get the behaviour that's more "correct" today.`})]})}function D(r={}){const{wrapper:e}=r.components||{};return e?n(e,{...r,children:n(i,{...r})}):i(r)}const w={title:"useState should require a dependency array",date:"2025-05-30"},T=()=>c(B,{postConfig:w,get children(){return c(D,{})}});export{T as default};
